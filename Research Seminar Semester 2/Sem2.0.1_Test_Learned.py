#test one on GA Boi.py
import libpyAI as ai
import math
from random import random

def getSendData():
    #Metadata
    heading = int(ai.selfHeadingDeg())
    tracking = int(ai.selfTrackingDeg())
    trackHeadRelative = (tracking-heading)/360
    speed = ai.selfSpeed()/10
    #Wall Feelers
    trackWall = ai.wallFeeler(500, tracking)
    trackL3 = ai.wallFeeler(500, tracking + 3)
    trackL10 = ai.wallFeeler(500, tracking + 10)
    trackR3 = ai.wallFeeler(500, tracking - 3)
    trackR10 = ai.wallFeeler(500, tracking - 10)
    frontWall = ai.wallFeeler(500, heading)
    frontL = ai.wallFeeler(500, heading + 10)
    frontR = ai.wallFeeler(500, heading - 10)
    leftWall = ai.wallFeeler(500, heading+90)
    rightWall = ai.wallFeeler(500,heading-90)
    backWall = ai.wallFeeler(500, heading - 180)
    backL = ai.wallFeeler(500, heading - 185)
    backR = ai.wallFeeler(500, heading - 175)
    
    data = [heading/360,tracking/360,trackHeadRelative,speed]
    for i in [trackWall,trackL3,trackL10,trackR3,trackR10,frontWall,frontL,frontR,leftWall,rightWall,backWall,backL,backR]:
        if i == -1:
            data.append(0)
        else:
            data.append(1 - i/500)

    return data

def getOutput(inputs, inputLayerNodeCount, innerLayerNodeCount, outputLayerNodeCount, weight):
	innerNodeOutput = []
	for i in range(innerLayerNodeCount):
		innerNodeOutput.append(0)
	outputNodeOutput = []
	for j in range(outputLayerNodeCount):
		outputNodeOutput.append(0)

	#calculate our neural net's outputs

	#for each node in the hidden layer
	for innerNode in range(innerLayerNodeCount):
		innerSum = 0
		#sum up all inputs * their given weights
		for inputValue in range(inputLayerNodeCount):
			innerSum += inputs[inputValue]*weight[innerNode][inputValue]
		#record the output in a list
		innerNodeOutput[innerNode] = squash(innerSum - weight[innerNode][inputLayerNodeCount])
	#for each node in the output layer
	for outputNode in range(outputLayerNodeCount):
		outputSum = 0
		#sum up all inputs * their given weights
		for innerNodeOpt in range(innerLayerNodeCount):
			outputSum += innerNodeOutput[innerNodeOpt]*weight[innerLayerNodeCount+outputNode][innerNodeOpt]
		#record the output in a list
		outputNodeOutput[outputNode] = squash(outputSum - weight[innerLayerNodeCount+outputNode][innerLayerNodeCount])

	return outputNodeOutput

def squash(inputSum):
	return 1/(1+math.exp(-inputSum))


def AI_loop():
	#Release keys
    ai.thrust(0)
    ai.turnLeft(0)
    ai.turnRight(0)
    ai.setTurnSpeed(45)
	
	#version 1A
    #weight = [[-0.5969508657403594, -0.4732666134275656, 0.9154852564711666, 0.02765348936505837, -0.7210895054591632, 0.3841144065333313, -0.04801117171905293, -1.333465705721978, -2.0828799457575524, 1.496554468007952, 0.07944522050666707, 2.2550246370223475, -1.3552064788389766, 1.0526326436679152, -2.2144419148261085, -2.209542876221214, -1.4013434612348339, -5.583782325006765], [8.199073021200933, 4.887937205649577, -2.9306179449451695, 12.986949301263389, -0.4546192236963681, 0.956479155786707, 2.497459308480612, 0.12923840586759355, 2.2081869917812447, -1.8938976416800946, -0.7912015900273511, -1.3598011844356346, 0.9199521038180047, -1.0053636248460476, -4.860515207300808, -4.247792543281844, -5.10520584572781, -2.827256645596371], [2.093928100405329, 1.171135223768654, -0.07965163340651536, 1.869914002230776, 1.088264177227082, 1.2586813435336703, 1.228577052652614, 1.2615993277217343, 1.2381748163575108, 0.9638223969033173, 1.1982052704592896, 1.105869760697951, 1.0138864019607778, 0.6767354261538808, 0.9828028270746909, 0.8803513943306723, 1.1458056873692177, -0.25327255436814305], [1.7867882645698807, 1.0509821062211544, 0.008600423020633758, 1.6582284267054075, 1.1635456260033532, 1.0174332392275478, 1.3942997202233636, 1.1185874630557247, 1.0610206654710381, 1.0315906435874393, 0.8664664119038413, 1.1378724844125325, 0.7175307195966908, 0.6293817819460061, 1.3856034102242887, 1.3310884319186476, 1.2197707177968267, -0.0725285878473949], [1.6164057621685146, 1.0361388765519208, 0.2595889415998664, 1.3249545726785519, 0.9994150287632377, 1.048628002752374, 1.0439664559593844, 1.2588785773452826, 1.1301391002336, 1.047381654626111, 1.150000881132432, 1.1218526254214953, 1.0700712637780472, 1.032695413215202, 1.408846399627459, 1.2392964932006505, 1.3823241572967502, -0.11415875231418346], [3.3808225546672146, 1.4644350074421684, -1.0141985121631951, 3.8756448080769528, 1.1599709598570227, 1.0891649223837283, 1.9620551961914614, 1.0631996987833583, 0.9658446094847332, 0.8216886480325815, 1.2034489149530507, 1.070502187786588, 0.3332017544644892, -0.44919169394804687, 0.3950833576811032, 0.08441003992286583, 0.025711078683872554, -0.33603098342718596], [2.6212053257021792, 1.411751963196469, -0.7059450725634584, 2.8578056964698866, 1.157884020006611, 1.5155387113212386, 1.7658083706634182, 1.0094382640289654, 1.2424898111990954, 1.1567592789349617, 0.9279631104747764, 1.078268252617033, 0.45099839669536596, 0.10757522444872353, 0.5380576979001472, 0.8075548328300844, 0.938238067442404, -0.09437862684957343], [-1.3332284092992772, 0.2259857989629735, 0.2957438049104158, 0.7188064616205458, 0.7136043109067804, 0.027918252594405606, -0.0775772681335106, 0.8552713522179799], [-11.235896086912467, -10.386794872455823, 1.9884948871257921, 2.854292895323306, 3.1484217204403944, 0.23615219005208724, 1.9434733143320173, -0.8733249251580883]]

	#version 1B
    #weight = [[0.2681511336461367, -0.7784864356715212, -0.34772753975865434, 10.89124284086589, -0.7552838597606043, -0.12461460900673121, 0.21180955005196514, -0.8462402452512391, 4.215472185102928, -0.37421698403648396, -0.2645169465661287, 3.187528820006615, -4.76787583310612, 2.5463894825224593, 1.4187288759160124, 1.321800270098147, 1.7129898941703734, 10.505709668773633], [1.446984718085253, 0.6365735468324653, 0.16805411008294763, -4.706793113064149, 1.00390981515536, -0.5450391740850202, -0.4492768024624965, 0.35777505885514316, -0.848538504304111, 0.1621958652229775, 0.8155771229163223, -1.601481565947228, 3.601288118842692, -0.04958628794434344, 5.979763390473255, 6.324198415821409, 5.746896115427732, 15.913468731072271], [0.26740395607648926, -1.4259967417959465, -1.1964991832430636, -1.1624914580824495, -0.12460463700956777, 0.1570415155037441, 1.7492720385285072, 0.15081154175490244, 3.689241689589641, -3.202062172911157, -4.889359055366902, -4.281555153106601, -0.46318319281522086, 3.6803805396046028, 3.628493056277547, 4.197145871363026, 4.253352115040429, 8.206421115174043], [1.8588249553618732, -1.2077708984648754, -2.2044801965607657, 7.073338817993485, 0.6272012310468352, -0.781146448238752, 2.7474947793270013, -0.3680403728016279, -1.046148048924242, 0.655317852923067, -3.699477406649416, 4.153020416676731, -3.4499452404556163, 1.9976262492785049, -1.5712973486413326, -1.588149890098579, -1.6886139408566343, 7.710046760008991], [-4.991093775562421, 0.5547787701515257, 6.01894688559489, 5.705017977287099, 0.10993558358727727, 0.24172369435627006, 1.051608836147949, 0.5864907848612706, 2.396326266516649, -0.05180927020089189, -1.5550606414229713, 2.9402400648428824, -0.3601481436832561, 3.843814089191117, 2.5449112743532782, 1.4792830926150573, 3.2129479982124067, 4.286432570777818], [-3.2126119034828498, -3.4377970374842493, 0.8437421013328404, 2.411764143167631, 1.6186931777159765, 2.5601691866590626, 3.120198057809587, 1.6571110435405265, 0.7400463065767565, 5.046748679823431, 1.8283839939390532, 7.169235267171604, 0.9559728252781347, -0.7870602135707685, 0.931065654944708, 0.795880060171822, 1.136208093355921, 10.121709814428993], [-0.5862211946085902, -0.9698927351507769, 0.6184967533365363, -9.997565558525723, 0.9905989549887552, -1.7877536972100505, -0.8590599504545058, 0.9042967553325297, -2.7529836381545536, -0.13194298195183485, 1.6701507452378397, 1.7952255979977996, -1.416164437289918, -1.7248931631020143, 4.453041973031533, 4.447436946740963, 4.167494609124514, 6.637533812678506], [-0.38743919445197494, -0.1797865078830225, -0.05717209477665283, -0.7829522136794517, -0.3308903594676447, 0.24321877455297194, -0.2881933360804583, -0.8849583679459011], [3.921489270704121, 6.083828834919879, 2.648170781180825, 1.0202105082949637, 1.7551259864981734, 1.860105408710194, 6.775260686530195, 11.903087938951307]]
	
	#Noshoot v1
    #weight = [[-0.7608713718614419, 1.2824407001862834, 3.6688430649146486, -2.775958629550436, 0.9203781265693176, -0.7378804656682817, 1.6280321606961021, 0.07925233650017145, -0.2519460463545722, -0.6572563658463514, 4.274533358877764, -5.923205132469782, 0.8604579159167208, -2.723742990492769, 0.7265411493975086, 1.8774426084615001, 1.266407274635769, -2.470341993400803], [4.97347088475218, 4.966857026415682, 0.7029304450066496, -9.630578400015187, 0.7354023308090303, 0.44742314397199234, 1.389282480046147, 1.2276497339468069, 0.6057954066584692, -1.0430929046002484, -1.9902156707709604, -2.529685063334117, -0.9751423128692404, 0.07741532045906215, -1.2794828759196089, 0.9393886393572297, -1.2022892245603265, -1.3886691201998629], [2.053828999317654, 1.1894959843791588, -1.3045609097721984, 0.49839365422022636, 0.9552025729116175, -0.09327210845870516, -0.0677455673146021, 0.6942530821538009, 1.075544243577461, 1.225184915094155, -0.07872752035075956, 0.19005595131180833, 1.3996599778322243, 0.5637386267247101, 1.3053997975896057, 0.8549100951458809, -0.13013806967049962, -1.4853009342146093], [0.14609490562195668, -2.1285390947841933, -3.5323462874056295, -3.6643486577082527, -1.2605233657021884, -1.840866997735839, 0.2820212400241096, -0.5862842933227728, -1.0822876218343873, -2.4717376901644172, 1.3561117760796604, 2.0977172324637663, 2.603921954888529, 0.30945624688593953, -0.45120866941371396, 0.967259984429422, -2.3451802960607195, 0.31642318622796733], [0.9184422753680791, -0.31056959893047137, -1.335951583753523, -7.606259662666723, 0.21637749009413795, 0.14934270972843375, 1.66575182844974, -0.35118966542326624, -0.30717025500436224, -0.6361104716074883, -5.761623701839427, 1.0565627657104175, 2.9487584358757224, 1.2638557480608241, 0.6155027958509693, 3.3964073525317904, -0.0974417637189294, 0.4675126147089894], [-1.4152538081043213, 0.8466018906858719, 0.7201536626560171, -2.5881821989598186, -0.44998829078574987, -0.5613830830836348, 1.000970393133837, -0.8431831924023269, -0.814244994766029, 4.71167847591233, 1.296295409130141, 3.588942671680544, 3.7659733304791465, -4.911161741688839, 0.7068927741648333, 2.185792443739423, -0.5729426846922907, -1.541829135205876], [-0.1977724079896894, -0.6774926172988404, -0.4839653236231653, -7.667375498773802, -0.5600011699320682, -0.17277284743432025, 1.3334794266718242, 0.823231594672335, 0.8641151961242177, -0.10387092230015411, 4.547928973048596, -2.2855105849863997, 3.0320979101854864, 0.5641674863485296, -0.35603064870588946, 2.232223031755114, -0.7647833695728727, -0.09868547507372455], [1.1635380195687681, 0.24666148302272045, 0.7342035641031324, 0.40337602812222206, 0.3318284108830305, 0.37153134626368145, 0.010391361262972378, 1.7999681748178433], [1.565679063965734, 5.842609775374908, -12.607147871221114, -5.290946320801482, 5.194788867679516, 4.168314903223669, 9.231364434407157, 7.429697362117419]]
	#Noshoot v1-2
    weight = [[-0.523648366622748, 0.6737802105515416, -0.6777211938040772, 2.310885695001683, 0.3793084195444118, 0.3117446626308341, 0.35598888117590055, -0.9169741649482971, -0.40135748650105935, -0.7944650927142426, 2.2499902997535104, -1.508170051441982, 2.8608169745744125, -2.062728874808884, -1.3007947639283488, -1.0777565856822886, -1.5328170364858038, 1.6757890256355175], [1.3023951198477313, 0.7699689837527657, -0.1536353100088202, 2.520539443875927, 0.46265312836154665, -0.519223062543929, 0.2593612927313037, -0.3394147871940334, -1.0411993289391017, 0.5130675357782304, 1.551142278689957, -0.11722461738943657, 1.5531457711598198, -0.5883932021437447, 1.292542902399451, 1.2405819968855798, 1.1179784230214667, -0.694788987716604], [-0.6577474211898349, 0.5601729424107601, 0.5549685772987183, 7.096170333678249, -0.26834721693071467, -0.9439484488649967, -0.24578665498594326, -0.6467342531350284, -1.2247833010136095, 0.37713468236053066, 0.7726890054228706, -0.3553739729085336, 0.2283660939710242, -0.23412881387270534, 0.3073837475905846, -0.5883515524944137, -1.0599564986844736, -1.6120631088328206], [0.24699078179103748, 0.012476259729837662, 0.20164922972507468, -2.521888279939676, 0.024292774951159873, -0.560265015680463, 0.3959366991011538, 0.340235445025212, -0.7282079261806126, -0.8612545643834322, 1.3462780218371613, -1.786390970593821, 1.3358415191038193, -0.8734204355476515, 1.2497521607823963, 2.1286427937105805, 1.3054912075860978, -0.770396203888962], [-0.07819731734944495, 1.0364261360208213, -0.42152618920171664, 4.427920535837348, -0.07474371880434033, -0.884650395950816, 1.2462304130571427, 0.6426177883587992, 0.2406317863755393, -0.3146975409370457, 1.2907078319930116, -0.7847179592524742, 0.9871778897588733, 0.39325611551652034, 0.7427337776499189, 1.2626967621695557, -0.5948479344266246, 0.39351346455392655], [0.5199131671710813, -0.3547089247527732, 0.10817700209562577, 4.894431714419473, 1.3912649612190635, -1.045136743525857, 0.08740426779845505, -0.29885506259852906, 0.811435622027283, 0.34110600700764704, 0.4769918641864976, 0.8143039819857993, 1.2304657048920185, -1.3879616587290093, -0.3554399901138692, 0.9941375951440845, -1.0714593325238713, 0.2441811181013753], [1.9345665199920938, 0.7792259076005569, -0.19087449470423654, 2.46172598554722, -0.028447333769217445, 0.601945789780282, 0.734797468696174, -0.682630631775266, 0.45637766748446496, 0.332827505127984, 0.9462339810152026, -0.5851632724789338, 0.7153719922902816, -1.0435242530070918, 1.7178198632467274, 2.3430902680815384, 0.47536334399199975, -1.5562849727089527], [2.1964659638675204, -0.06847781880048052, -0.13617950215280822, 2.2618810701578957, 0.650351639547002, 1.0241572756356, -1.111645715130463, 1.712990272109526], [-4.73370630324334, -1.1280443953518993, -15.898585311857829, 14.986837797219264, -2.657780303013172, -6.937665665134543, -1.3466226728356736, -9.475370672276352]]
	#Noshoot v1-3
    #weight = [[-0.6173104351583574, -1.9634722071802821, 0.8556065219221339, 10.595867334439665, 0.936381653488983, 0.10685815159859442, 0.1716231423882745, 0.3427417518615279, 1.0635663670958777, -0.8165035042494406, -1.024499882878525, 1.60924534078725, -0.03200175236283444, 0.03180359517540879, -2.1657609501100636, -2.361509860950295, -1.1969181992543385, -2.8685295214345454], [-3.8587233425685583, -3.438784342583837, -0.4889402235415841, 7.714965369853793, -1.2966113229177485, -0.4626326810920506, -1.3971878184541, -1.5267676316701861, -0.47399005824719687, 1.2952845364656105, 0.01597645980348783, 3.2541628894929344, -0.5850759296319805, 0.5181241682040096, -0.5394064746914276, -0.1132004849231677, -1.089724729441609, -2.9854401423420893], [3.7103455177970823, 2.4644163742117717, -0.6660620641314126, 6.764446323936804, -0.691476434360548, -1.2498656639438097, -2.4797103093836896, -0.22118798404469395, -1.5655533009246494, -4.356667417354522, -1.1626438596295912, -1.3822163438343391, -2.092131497723959, 3.9109507850950873, -1.9047949436578617, -2.3292027730226814, -0.5069934410212917, -2.6224305080576182], [-1.5189325948467967, -1.784842485508004, 1.0193742275991982, 7.063375420678419, -1.4784035376427729, -0.6551582877896561, -2.7157078074610843, -1.2955485048416804, -1.2756417092904646, 1.6664914300692126, 3.1150604282563026, 0.525993236912345, 0.5012767987182355, -3.302742686913104, 0.6059507147888982, -0.8426919341766783, -0.3612629058808396, -3.538962213409295], [-2.6036964387704806, -1.2151003700377025, -0.14942765064603972, 4.1465211181289625, -1.2525520860783663, -0.6543131928369587, -0.07591262723042351, -0.4240267630022019, -1.4371208225919214, -0.2507009810025328, 3.447728149714406, -0.5027024394008355, 1.6883648907201076, -3.008110918340829, -0.9569301740796176, -0.31783586471243136, -0.784462371528579, -1.3079634965538889], [-1.5117130525024167, -0.629515215947883, -0.5196671524358871, 6.750580537875724, 1.6186512169025595, 0.722883193197627, 1.5498148516007304, 0.9399218246860531, 0.9620789068114982, 0.09653210497387418, 0.5565208799212762, 0.42071164971705843, 2.204049357280753, -0.6101176959289042, -1.87274499271601, -0.8015304817852884, -1.8445444275981542, -1.053492884766106], [0.16400007984644277, -0.34365829779883605, 0.4065275409027187, 5.764770075602008, 2.209680804821531, 1.5980085163488706, 2.142680866342871, 2.9495388326614753, 2.2956341973355654, -0.18638147146956002, 0.5267211734124009, 0.8618750732907905, 1.6623237521782412, -0.937433167288873, -2.2815565582946795, -0.54903289887583, -2.1304021648074145, -0.04086804469866202], [0.060220329632372026, -0.8006472537344698, 0.1549483820269741, -0.10917253010723192, 0.8369533550396467, 0.1685481600850116, -0.5918867878738221, -0.03209096680160201], [-6.7207674468653, -3.444073746774089, -3.684179979113248, -3.3506778010807166, 0.8848310688536876, 1.4643948247427276, -2.6774412529725247, -9.224925313209303]]
	#Noshoot v1-4
    #weight = [[-1.2254823813683628, -1.2413994149658136, 0.2724040210447855, 7.896943281907367, 0.4510061838483749, -1.7890631631851641, -2.195854383271549, -0.7785201327676741, 0.6198291419962145, -0.9806584002640939, -3.2779662235472533, 1.514843396360745, -3.5829674940947203, 0.42148498789222155, 0.045184279753219876, -1.3479963394723495, 1.7644585048827357, -0.9775320751334675], [-3.8099892000818687, 1.05366565474982, 6.997853582801975, 7.50117823194866, -0.771224684060926, -0.4975920045634131, 0.923088295139541, -0.5158659402259685, 0.6440734183715445, 1.0845131390251004, 1.0533379936905634, 0.228419357719898, 2.1111212023271277, 2.8825991954219465, -1.9146175255598368, -2.101304904682205, -1.0688483302068723, -1.5149672998896324], [-0.16896876952642223, -1.5898334672124559, -1.94770930083151, 5.011186661097234, 0.34216863983924534, -0.9305576776981902, -1.8192183644550493, 0.010821161151808822, -0.4035497239955152, -0.9326671457553178, -2.565160474573906, -1.5851786754610084, -2.6588724381839004, -0.23707839772335387, -0.8643120091364569, -3.0719584535832682, 0.5493808128422516, -1.4759888659401386], [0.409773821400828, 0.6230128893922686, -1.0062584804300325, 8.894392660899799, 1.3607945432775868, 0.3907735951055137, 1.7273689942689003, 0.8542857440313559, -0.23057557816051336, 0.274646720374454, 4.344425359037093, -1.1884874352814923, 2.9646612262720526, -0.5548420989123097, -2.73853596767297, -2.6207152960182354, -1.5984336680923963, -0.21844664375408168], [0.02399018575860666, 1.1305915786763208, -1.523817524178679, 6.802027683194632, -0.9626518858684727, -0.8826297439595027, -1.0076698317091224, -0.05020894373697098, -2.1460669362816676, 1.9134016190456173, 4.638951947276567, -0.7005734527679555, 2.211945668791299, -1.7422696653061847, -1.316615324597362, -4.399870148965819, -0.22546506506965294, -1.3259706869536556], [2.064801370048183, 0.9036407667541702, -1.1516725526014224, 7.092115958518942, 0.11071106639236498, -0.3879621065775658, -2.2226645378605387, -0.814552226582329, -0.7425694345715449, -1.0625600137407194, -1.8801184025854731, -1.325731944922365, -2.0143389105272202, -2.8519195569806257, -1.3454670475912036, -1.6602907947996206, -0.17921004046516856, -2.77987225295328], [-0.17432445592006093, 0.7076352070199425, 0.6498496537253902, 4.159176102208817, -0.8243658654419586, -0.2634755087527998, -1.7706857210435114, -0.6780047683677458, -0.1286686314602391, 1.1379322979599376, -0.472437986263639, 4.154376532550854, -1.9957401307828966, 2.899722236507257, -1.185449437053469, -3.147641330245651, -0.270985234318826, 0.910798607059526], [-0.784713554826718, 0.23227350147236667, -0.21971985735853292, -0.04077265595083074, 0.12495984500957646, 0.2430649454543595, -0.8984008343141846, -0.030255730136855237], [-5.0424098265973685, -3.775268088007711, -0.9940376328604708, -5.107357168520149, -4.284308967829731, -2.7190366214463313, -2.553641432317105, -9.92953980599276]]

    sendData = getSendData()
    output = getOutput(sendData, 17, 7, 2,  weight)

    turn, thrust = "N", "N"

    if output[0] >= .6:
        ai.turnRight(1)
        turn = "R"
    elif output[0] < .4:
        ai.turnLeft(1)
        turn = "L"
    ai.setTurnSpeed(abs(output[0]-.5)*100)

    if output[1] > random():
        ai.thrust(1)
        thrust = "Y"

    if ai.selfAlive():
        print (turn +"  "+ str(round(output[0],3)) +"  |  "+ thrust +"  "+ str(round(output[1],3)))


ai.start(AI_loop,["-name","Sem2Learned","-join","localhost"])  
